import{__assign as e,__awaiter as t,__generator as r,__read as n,__values as o,__extends as i,__spreadArray as a}from"tslib";import{LiffModule as c}from"@liff/use";import{done as s}from"@liff/ready";import{isLoggedIn as l}from"@liff/is-logged-in";import{convertHexToRgb as f,convertArgbToRgba as u,createLiffError as d,base64Url as h,convertArrayBuffer as p,compareVersion as v,qs as m,extractChannelIdFromLiffId as w,addParamsToUrl as g,randomAlphaNumericString as b,replaceUrlCredentialRemoved as k}from"@liff/util";import{getContext as C,getLoginTmp as F,getExpireTime as y,getIsSubsequentLiffApp as I,getFeatureToken as _,setIsSubsequentLiffApp as B,getMST as x,getAccessToken as S,getRawContext as T,getIDToken as A,getClientId as E,getMSTChallenge as L,getMSTVerifier as N,getMSIT as D,getConfig as O,setDecodedIDToken as P,setAppData as U,setMST as W,setFeatureToken as j,setExpireTime as M,setAccessToken as H,setContext as K,setMSTChallenge as R,setMSTVerifier as V,setClientId as J,setMSIT as q,setIDToken as z,getDecodedIDToken as G,removeLoginTmp as Q,setConfig as X}from"@liff/store";import{CheckAvailability as Y}from"@liff/check-availability";import{FORBIDDEN as Z,INIT_FAILED as $,INVALID_ID_TOKEN as ee,SUB_WINDOW_STATUS as te,SUB_WINDOW_HEALTH_CHECK_MESSAGE as re,INVALID_CONFIG as ne}from"@liff/consts";import{load as oe}from"@liff/extensions";import{isInClient as ie}from"@liff/is-in-client";import{logout as ae}from"@liff/logout";import{isSubWindow as ce}from"@liff/is-sub-window";import{getMSTByMSIT as se,getAppData as le,getMainWindowOrigin as fe,getMessageBus as ue,initMessageBus as de,setMainWindowOrigin as he}from"@liff/sub-window";import{fetch as pe,getEndPoint as ve,verifyAccessToken as me}from"@liff/server-api";import{logger as we}from"@liff/logger";import{getLineVersion as ge}from"@liff/get-line-version";import{addListener as be,removeListener as ke}from"@liff/native-bridge";import{isApiAvailable as Ce}from"@liff/is-api-available";import{getOS as Fe}from"@liff/get-os";import{login as ye}from"@liff/login";import{closeWindow as Ie}from"@liff/close-window";import{EVENT_NAME as _e,WINDOW as Be,IDENTIFIER_KEY as xe}from"@liff/message-bus";import{AsyncHook as Se}from"@liff/hooks";import{t as Te}from"@liff/i18n";var Ae={iconColor:"#111111",statusBarColor:"BLACK",titleTextColor:"#111111",titleSubtextColor:"#B7B7B7",titleButtonColor:"#111111",titleBackgroundColor:"#FFFFFF",progressBarColor:"#06C755",progressBackgroundColor:"#FFFFFF",titleButtonAreaBackgroundColor:"#1FFFFFFF",titleButtonAreaBorderColor:"#26000000",baseBackgroundColor:"#FFFFFF",baseTextColor:"#000000",lightButtonBorderColor:"rgba(0, 0, 0, 0.15)"},Ee={iconColor:"#FFFFFF",statusBarColor:"WHITE",titleTextColor:"#FFFFFF",titleSubtextColor:"#949494",titleButtonColor:"#FFFFFF",titleBackgroundColor:"#111111",progressBarColor:"#06C755",progressBackgroundColor:"#111111",titleButtonAreaBackgroundColor:"#1FFFFFFF",titleButtonAreaBorderColor:"#26000000",baseBackgroundColor:"#000000",baseTextColor:"#FFFFFF",lightButtonBorderColor:"rgba(255, 255, 255, 0.5)"};function Le(){var e;Oe("color-scheme",((null==(e=C())?void 0:e.menuColorSetting)||{adaptableColorSchemes:["light"]}).adaptableColorSchemes.join(" "));var t=window.matchMedia("(prefers-color-scheme: dark)");Ne({matches:null==t?void 0:t.matches,media:null==t?void 0:t.media}),t.addEventListener?t.addEventListener("change",Ne):t.addListener&&t.addListener(Ne)}function Ne(t){var r=C(),n=(null==r?void 0:r.menuColorSetting)||{adaptableColorSchemes:["light"],lightModeColor:Ae,darkModeColor:Ee},o=n.adaptableColorSchemes,i=n.lightModeColor,a=n.darkModeColor,c=o.includes("dark");t.matches&&c?De(e(e({},Ee),a)):De(e(e({},Ae),i))}function De(e){var t=e.iconColor,r=e.statusBarColor,n=e.titleTextColor,o=e.titleSubtextColor,i=e.titleButtonColor,a=e.titleBackgroundColor,c=e.progressBarColor,s=e.progressBackgroundColor,l=e.titleButtonAreaBackgroundColor,d=e.titleButtonAreaBorderColor,h=e.baseBackgroundColor,p=e.baseTextColor,v=e.lightButtonBorderColor;Oe("--liff-base-background-color",h),Oe("--liff-base-text-color",p),Oe("--liff-base-background-rgb-color",f(h)),Oe("--liff-base-text-rgb-color",f(p)),Oe("--liff-light-button-border-color",v),Oe("--liff-title-text-color",n),Oe("--liff-title-background-color",a),Oe("--liff-title-button-color",i),Oe("--liff-icon-color",t),Oe("--liff-status-bar-color",r),Oe("--liff-title-subtext-color",o),Oe("--liff-progress-bar-color",c),Oe("--liff-progress-background-color",s),Oe("--liff-title-button-area-background-color",u(l)),Oe("--liff-title-button-area-border-color",u(d))}function Oe(e,t){document.documentElement.style.setProperty(e,t)}var Pe={addToHomeScreen:function(e){if(!new Y(e).invoke("addToHomeScreen"))throw d(Z,"No permission for liff.addToHomeScreen()")},scanCode:function(e){if(!new Y(e).invoke("scanCode"))return Promise.reject(d(Z,"No permission for liff.scanCode()"))},getAdvertisingId:function(e){if(!new Y(e).invoke("getAdvertisingId"))return Promise.reject(d(Z,"No permission for liff.getAdvertisingId()"))},initPlugins:function(){}};function Ue(e){return t(this,void 0,void 0,(function(){var t;return r(this,(function(r){switch(r.label){case 0:return[4,oe()];case 1:return(t=r.sent())?(t.install(e,Pe),[2]):[2]}}))}))}function We(){return t(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,pe(ve("certs"))];case 1:return[2,e.sent()]}}))}))}function je(e,n,o){return t(this,void 0,void 0,(function(){var t;return r(this,(function(r){switch(r.label){case 0:return[4,crypto.subtle.importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"])];case 1:return t=r.sent(),[4,crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},t,o,n)];case 2:return[2,r.sent()]}}))}))}function Me(e,o){return t(this,void 0,void 0,(function(){var t,i,a,c,s,l,f,u,v,m,w,g,b,k,C,F;return r(this,(function(r){switch(r.label){case 0:return t=e.split("."),i=n(t,3),a=i[0],c=i[1],s=i[2],l=JSON.parse(h.decode(a)),f=JSON.parse(h.decodeUnicode(c)),u=p(h.decode(s)),v=p("".concat(a,".").concat(c)),[4,We()];case 1:if(m=r.sent(),!(w=m.keys.find((function(e){return e.kid===l.kid}))))return[3,6];if(delete w.alg,"ES256"!==l.alg)throw d(ee,'Invalid "alg" value in ID_TOKEN');g=void 0,r.label=2;case 2:return r.trys.push([2,4,,5]),[4,je(w,v,u)];case 3:return g=r.sent(),[3,5];case 4:throw b=r.sent(),d(ee,"".concat("Failed to use Crypto API to verify ID_TOKEN",": ").concat(b));case 5:if(g){if(k=f.iss!=="https://access.".concat("line.me"),C=f.aud!==o,F=1e3*f.exp<Date.now(),k)throw d(ee,'Invalid "iss" value in ID_TOKEN');if(C)throw d(ee,'Invalid "aud" value in ID_TOKEN');if(F)throw d(ee,'Invalid "exp" value in ID_TOKEN');return[2,f]}throw d(ee,"Invalid signature in ID_TOKEN");case 6:throw d(ee,'Invalid "kid" value in ID_TOKEN');case 7:return[2]}}))}))}function He(e){var t=e.split(".");if(t[1])try{var r=t[1].replace(/-/g,"+").replace(/_/g,"/");return JSON.parse(window.atob(r))}catch(n){return null}return null}function Ke(e){var t=e.pathname,r=e.query,n=r?"?".concat(m.stringify(r)):"",o="".concat("liff://").concat(t).concat(n);location.href=o}var Re=null;function Ve(){"boolean"==typeof Re&&we.warn("liff.init is not expected to be called more than once"),Re=!!I()||!(!ie()||m.parse(window.location.hash).feature_token||_())&&(B(!0),!0)}function Je(){return Boolean(Re)}function qe(e,n){return t(this,void 0,void 0,(function(){var t;return r(this,(function(r){switch(r.label){case 0:return(t=x())?[2,t]:e&&n?[4,se({msit:e,mstVerifier:n})]:[3,2];case 1:return[2,r.sent().mst];case 2:return[2,null]}}))}))}function ze(e){return pe("".concat(ve("apps"),"/").concat(e,"/featureToken"))}function Ge(e){return t(this,void 0,void 0,(function(){var t,n,i,a;return r(this,(function(r){switch(r.label){case 0:return t=m.parse(window.location.hash),n=function(e){for(var t,r,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var a=function(t){Object.keys(t).filter((function(e){return null!==t[e]&&void 0!==t[e]})).forEach((function(r){e[r]=t[r]}))};try{for(var c=o(n),s=c.next();!s.done;s=c.next()){a(s.value)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return e}({access_token:S(),context_token:T(),feature_token:_(),id_token:A(),client_id:E(),mst_challenge:L(),mst_verifier:N(),msit:D()},t),Je()?l()?[4,ze(e)]:[3,2]:[3,3];case 1:i=r.sent().featureToken,n.feature_token||(n.feature_token=i),r.label=2;case 2:(a=w(e))&&(n.client_id=a),r.label=3;case 3:return[2,n]}}))}))}function Qe(e){if(e.persisted&&Ce("multipleLiffTransition"))if("ios"===Fe())window.location.reload();else{var t=O().liffId,r=_();if(!t)throw d($,"Invalid LIFF ID.");if(!r)throw d(Z,"Invalid featureToken for client features");Ke({pathname:"app/".concat(t),query:{feature_token:r}})}}function Xe(e){return t(this,void 0,void 0,(function(){var t,n,o,i,a,c,s,f,u,h,p,m,b,k,F,y,I,_,B;return r(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(e){var t=ge();if(!t||v(t,"9.5.0")<0)e();else if(window._liff&&window._liff.features)e();else{we.debug("cannot find window._liff.features, listen to ready event");var r=function(){we.debug("ready event is fired"),ke("ready",r),e()};be("ready",r)}}))];case 1:return r.sent(),Ve(),[4,Ge(e.liffId)];case 2:if(t=r.sent(),n=t.access_token,o=t.context_token,i=t.feature_token,a=t.id_token,c=t.client_id,s=t.mst_verifier,f=t.mst_challenge,u=t.msit,o){if("string"!=typeof o)throw d($,"Cannot get context token, perhaps there is an incorrect parameter in permanent link");K(He(o))}if(void 0!==(null===(_=C())||void 0===_?void 0:_.liffId)&&(null===(B=C())||void 0===B?void 0:B.liffId)!==e.liffId)throw d($,"Invalid LIFF ID");return!ce()&&i&&(!function(e,t){Ce("multipleLiffTransition")&&Ke({pathname:"app/".concat(e),query:{feature_token:t}})}(e.liffId,i),Je()&&j(i)),f&&R(f),s&&V(s),c&&J(c),u&&q(u),window.addEventListener("pageshow",Qe),l()?[3,5]:i&&n?[3,5]:Je()?(h=g(location.href,{"liff.hback":"2"}),ye({redirectUri:h}),[4,new Promise((function(){}))]):[3,4];case 3:r.sent(),r.label=4;case 4:throw ye(),d($,"Failed to parse feature_token or access_token");case 5:return n&&i?[4,me(n)]:[3,7];case 6:if(p=r.sent(),m=p.client_id,b=p.expires_in,k=w(e.liffId),m!==k)throw ye(),d($,"Failed to verify access_token");j(i),M(new Date(Date.now()+1e3*b)),H(n),r.label=7;case 7:return[4,qe(u,s)];case 8:return(F=r.sent())?(W(F),[4,le({mst:F})]):[3,10];case 9:(y=r.sent().data)&&U(JSON.stringify(y)),r.label=10;case 10:return a&&!A()&&z(a),a&&c&&!G()?[4,Me(a,c)]:[3,12];case 11:(I=r.sent())&&P(I),r.label=12;case 12:return[2]}}))}))}function Ye(e){return t(this,void 0,void 0,(function(){var t,n,o,i,a,c,s;return r(this,(function(r){switch(r.label){case 0:return t=ve("apps"),n="".concat(t,"/").concat(e,"/contextToken"),o=S(),i={"Content-Type":"application/json",Accept:"application/json"},o&&(i.Authorization="Bearer ".concat(o)),[4,pe(n,{headers:i})];case 1:if(a=r.sent(),!(c=a.contextToken))throw d($,"Can not get context from server.");if(!(s=He(c)))throw d($,"Invalid context token.");return[2,s]}}))}))}function Ze(){return t(this,void 0,void 0,(function(){var e,t;return r(this,(function(r){switch(r.label){case 0:if(!(e=O().liffId))throw d($,"Invalid LIFF ID.");return[4,Ye(e)];case 1:return t=r.sent(),K(t),[2]}}))}))}function $e(e){return t(this,void 0,void 0,(function(){var n,o,i,a=this;return r(this,(function(c){switch(c.label){case 0:n=function(){return t(a,void 0,void 0,(function(){var t,n,o,i,a,c;return r(this,(function(r){switch(r.label){case 0:return[4,(s=O(),l=m.parse(window.location.search),f=F(),u={grant_type:"authorization_code",client_id:l.liffClientId,appId:s.liffId,code:l.code,code_verifier:f.codeVerifier,redirect_uri:s.redirectUri||l.liffRedirectUri,id_token_key_type:"JWK"},d=m.stringify(u),pe(ve("token"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:d}))];case 1:return t=r.sent(),n=t.access_token,o=t.id_token,i=t.expires_in,J(e),H(n),M(new Date(Date.now()+1e3*i)),Q(),o?(z(o),[4,Me(o,e)]):[3,3];case 2:(a=r.sent())&&P(a),r.label=3;case 3:return(c=m.parse(location.hash).context_token)?(K(He(c)),[3,6]):[3,4];case 4:return[4,Ze()];case 5:r.sent(),r.label=6;case 6:return[2]}var s,l,f,u,d}))}))},c.label=1;case 1:return c.trys.push([1,3,,4]),[4,n()];case 2:return c.sent(),[3,4];case 3:throw o=c.sent(),i=o,Q(),i;case 4:return[2]}}))}))}function et(){return t(this,void 0,void 0,(function(){var e,n,o,i,a,c,s=this;return r(this,(function(f){switch(f.label){case 0:return(n=ue())?[3,2]:[4,de(Be.SUB)];case 1:n=f.sent(),f.label=2;case 2:return(e=n).isReady()?(o=b(8),[4,e.getData("appData")]):[3,8];case 3:return i=f.sent(),a=i.eventName,c=i.data,a!==_e.NOT_FOUND?[3,6]:[4,e.teardown()];case 4:return f.sent(),[4,et()];case 5:return[2,f.sent()];case 6:c&&U(JSON.stringify(c)),f.label=7;case 7:return e.listen((function(n){return t(s,void 0,void 0,(function(){var t,i;return r(this,(function(r){return t=n.context,i=t.data,t.eventName===te.INIT&&(null==i?void 0:i.subWindowId)!==o&&Ie(),t.eventName!==te.CANCEL&&t.eventName!==te.SUBMIT||e.teardown(),[2]}))}))})),l()&&e.send({eventName:te.INIT,data:{subWindowId:o,hasOpener:!!window.opener}}),[3,10];case 8:return fe()?[3,10]:[4,new Promise((function(e){window.addEventListener("message",function(e){return function t(r){var n=r.data,o=r.source,i=r.origin;if(n){var a=n.type,c=n.message;a===re&&(window.removeEventListener("message",t),c&&U(c),he(i),o&&o.postMessage&&o.postMessage({status:re},i),e())}}}(e))}))];case 9:return[2,f.sent()];case 10:return[2]}}))}))}var tt=new(function(){function e(){var e=this;this.getAndValidateContext=function(){var e=C();if(!e)throw d($,"Could not get Context from server.");if(!e.endpointUrl)throw d($,"Could not get endpointUrl from server.");if(!e.permanentLinkPattern)throw d($,"Could not get permanentLinkPattern from server.");return e},this.decodeState=function(t){var r=e.getAndValidateContext();t=t.replace(/\n/g,"%0D%0A");var n=e.hasTrailingSlash(r.endpointUrl)||e.hasTrailingSlash(t),o=new URL(r.endpointUrl),i=o.origin,a=o.pathname,c=o.search,s=new URL("".concat(i).concat(e.attachSlashAtStart(t))),l=s.pathname,f=s.search,u=s.hash,d="".concat(c).concat(c?f.replace(/\?/g,"&"):f),h="".concat(a).concat(e.attachSlashAtStart(l)).replace("//","/");return(h=e.attachSlashAtStart("".concat(h))).endsWith("/")&&!n&&(h=h.substring(0,h.length-1)),"".concat(i).concat(h).concat(d).concat(u).replace(/%0D%0A/g,"\n")}}return e.prototype.attachSlashAtStart=function(e){return"".concat(e&&e.length>0&&!e.startsWith("/")?"/":"").concat(e)},e.prototype.hasTrailingSlash=function(e){var t=e.indexOf("?"),r=e.indexOf("#"),n=-1;return(n=-1===t&&-1===r?e.length:-1===t?r:-1===r?t:Math.min(t,r))>0&&"/"===e[n-1]},e.prototype.invoke=function(){return t(this,void 0,void 0,(function(){var e,t,n,o,i;return r(this,(function(r){switch(r.label){case 0:if(e=m.parse(window.location.search),"string"!=typeof(t=e["liff.state"]))return[2];r.label=1;case 1:return r.trys.push([1,4,,5]),n=location.href,(o=this.decodeState(t))===n?[3,3]:(e["liff.hback"]?location.replace(g(o,{"liff.hback":e["liff.hback"]})):location.replace(o),[4,new Promise((function(){}))]);case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:if((i=r.sent()).code===$)throw i;return we.debug(i),[3,5];case 5:return[2]}}))}))},e}());function rt(e,n){return t(this,void 0,void 0,(function(){var t;return r(this,(function(r){switch(r.label){case 0:if(!e.liffId)throw d(ne,"liffId is necessary for liff.init()");return X(e),!ie()&&l()&&(y()||ae()),t=m.parse(window.location.search),!ce()||ie()?[3,2]:[4,et()];case 1:r.sent(),r.label=2;case 2:if(t.error&&t.liffOAuth2Error)throw a=t.error,c=t.error_description,s=c.replace(/\+/g," "),f="".concat(a,": ").concat(s),d($,f);return o=t.code,i=F(),Boolean(o&&!l()&&i&&i.codeVerifier)?[4,$e(t.liffClientId)]:[3,4];case 3:r.sent(),r.label=4;case 4:return ie()?[4,Xe(e)]:[3,6];case 5:return r.sent(),[3,8];case 6:return l()?[3,8]:[4,Ze()];case 7:r.sent(),r.label=8;case 8:return[4,tt.invoke()];case 9:return r.sent(),[4,n()];case 10:return r.sent(),k(window.location.href),[2]}var o,i,a,c,s,f}))}))}var nt=function(e,t){return new Promise((function(r,n){if(e){var o=document.createElement("script");o.type="module",o.onload=function(){r()},o.src=e,document.head.appendChild(o)}else n(d(ne,t))}))},ot=function(e){var t="https://static.line-scdn.net/lui/edge/versions/1.13.0/lui-alert.js";return t&&e&&(t=t.replace(/\d{1,2}\.\d{1,2}\.\d{1,3}/,e)),nt(t,"LUI_ALERT_URL is not defined")},it=function(){return t(void 0,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return e=function(){var e,t=document.querySelector('script[src*="luivendor.js"]');if(t&&(null===(e=t.src.match(/\d{1,2}\.\d{1,2}\.\d{1,3}/g))||void 0===e?void 0:e.length))return t.src.match(/\d{1,2}\.\d{1,2}\.\d{1,3}/g)[0]}(),e?[3,2]:[4,nt("https://static.line-scdn.net/lui/edge/versions/1.13.0/luivendor.js","LUI_VENDOR_URL is not defined")];case 1:t.sent(),t.label=2;case 2:return[4,ot(e)];case 3:return t.sent(),[4,(r=b(6),new Promise((function(){var e=document.createElement("div");e.innerHTML='<lui-alert id="'.concat("liffAlert","-").concat(r,'" shown title="').concat(Te("alert.android.extBrowser.autoLoginWorkaround.title"),'" message="').concat(Te("alert.android.extBrowser.autoLoginWorkaround.desc"),'" button="').concat(Te("alert.android.extBrowser.autoLoginWorkaround.button.text"),'"></lui-alert>'),document.body.appendChild(e);var t=document.getElementById("".concat("liffAlert","-").concat(r));t&&t.addEventListener("lui-button-click",(function(){var e=window.open(g(window.location.href,{liffIsEscapedFromApp:"true"}),"_blank");e&&(e.location.href=g(window.location.href,{liffIsEscapedFromApp:"true"}),window.close())}))})))];case 4:return t.sent(),[2]}var r}))}))},at=function(e){try{return new URL(e).searchParams.get("lineAppVersion")}catch(t){return null}};function ct(){return t(this,void 0,void 0,(function(){var e,t,n;return r(this,(function(r){switch(r.label){case 0:return e=null!==(n=at(window.location.href))&&void 0!==n?n:at(window.document.referrer),!!e&&v(e,"13.10.0")>=0?[2]:ie()||"android"!==Fe()||(t=m.parse(window.location.search))[xe]||t.liffIsEscapedFromApp?[2]:t.liffClientId&&document.referrer.includes("access.".concat("line.me"))?(window.location.href=g(window.location.href,{liffIsEscapedFromApp:"true"}),[2]):t.liffClientId&&document.referrer.includes("android-app://")?[4,it()]:[3,2];case 1:r.sent(),r.label=2;case 2:return t.liffClientId&&""===document.referrer&&1===window.history.length?[4,it()]:[3,4];case 3:r.sent(),r.label=4;case 4:return!document.referrer.includes("liffClientId")||document.referrer.includes("liffIsEscapedFromApp")?[3,6]:[4,it()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))}var st=function(e){function o(){var t=e.apply(this,a([],n(arguments),!1))||this;return t.hooks={before:new Se,after:new Se},t.internalHooks={beforeFinished:new Se,beforeSuccess:new Se,error:new Se},t}return i(o,e),Object.defineProperty(o.prototype,"name",{get:function(){return"init"},enumerable:!1,configurable:!0}),o.prototype.install=function(e){var t=e.liff;return this.liffForWindow=t,this.init.bind(this)},o.prototype.init=function(e,n,o){return t(this,void 0,void 0,(function(){var t;return r(this,(function(r){switch(r.label){case 0:return[4,this.hooks.before.call()];case 1:r.sent(),i=this.liffForWindow,window&&!window.liff&&(window.liff=i),r.label=2;case 2:return r.trys.push([2,9,,11]),[4,Promise.all([Ue(this.liffForWindow),rt(e,this.internalHooks.beforeFinished.call)])];case 3:return r.sent(),Le(),[4,this.internalHooks.beforeSuccess.call()];case 4:return r.sent(),!e.withLoginOnExternalBrowser||l()?[3,6]:(ye(),[4,new Promise((function(){}))]);case 5:r.sent(),r.label=6;case 6:return[4,ct()];case 7:return r.sent(),[4,this.hooks.after.call()];case 8:return r.sent(),"function"==typeof n&&n(),s(),[3,11];case 9:return t=r.sent(),[4,this.internalHooks.error.call(t)];case 10:throw r.sent(),"function"==typeof o&&o(t),t;case 11:return[2]}var i}))}))},o}(c);export{st as InitModule};
